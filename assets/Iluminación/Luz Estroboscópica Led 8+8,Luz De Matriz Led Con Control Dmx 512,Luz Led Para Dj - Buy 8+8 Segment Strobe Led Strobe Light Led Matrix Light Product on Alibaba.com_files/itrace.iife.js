var itraceNext=function(t){"use strict";function e(t,r){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,r)}var r=function(t){return t.ZH="cn",t.QUARK="quark",t.INTL="intl",t}({});!function(t){t[t.JSERR=1]="JSERR",t[t.API=2]="API",t[t.PERF=3]="PERF",t[t.RESERR=4]="RESERR",t[t.PVUV=5]="PVUV",t[t.BKPG=6]="BKPG",t[t.LONGTASK=8]="LONGTASK",t[t.INPD=15]="INPD",t[t.NODERES=16]="NODERES",t[t.PGERROR=17]="PGERROR",t[t.BLOCK=18]="BLOCK",t[t.PERFNEXT=1e3]="PERFNEXT",t[t.MAINDOC=1e5]="MAINDOC",t[t.RESTIMING=100001]="RESTIMING"}({});var n=function(t){return t.JSERR="jserr",t.API="api",t.PERF="jsfsperf",t.RESERR="resloadfail",t.PVUV="flow",t.BKPG="bkpg",t.CUSTOM="jssdkidx",t.INPD="inputdelay",t.LONGTASK="longtask",t.NODERES="nodres",t.PGERROR="pgerror",t.BLOCK="h5block",t}({});function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i.apply(null,arguments)}function o(t){if(c(console)&&d(console.warn)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).warn.apply(e,["[itrace says] "+t].concat(n))}}function s(t){return void 0!==t}function a(t){var e=Date.now();"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:11&r).toString(16)});return!1===t?r.replace(/-/g,""):r}function c(t){return"object"==typeof t}function u(t){return"[object Array]"==={}.toString.call(t)}function d(t){return"function"==typeof t}function p(t){var e;switch(t){case 1:e=n.JSERR;break;case 2:e=n.API;break;case 3:e=n.PERF;break;case 4:e=n.RESERR;break;case 5:e=n.PVUV;break;case 6:e=n.BKPG;break;case 8:e=n.LONGTASK;break;case 15:e=n.INPD;break;case 16:e=n.NODERES;break;case 17:e=n.PGERROR;break;case 18:e=n.BLOCK;break;default:e=n.CUSTOM}return e}function l(t){var e=+new Date;return!0===t&&(e=Math.floor(e/1e3)),e}function f(t){var e=[];for(var r in t)e.push(r+"="+t[r]);return e.join("&")}function h(t){return!!t&&(t>=1||"100%"===t||(/^\d+(\.\d+)?%$/.test(t)?Math.random()<parseFloat(t)/100:t>0&&t<1&&Math.random()<t))}function g(){for(var t=arguments.length<=0?void 0:arguments[0],e=1,r=arguments.length;e<r;e++){var n=e<0||arguments.length<=e?void 0:arguments[e];for(var i in n)E(n,i)&&(t[i]=n[i])}return t}function v(t,e){if(-1===e)t();else var r=setTimeout(function(){t(),clearTimeout(r)},e||0)}function _(t,e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),t.addEventListener?t.addEventListener(e,function o(s){i&&t.removeEventListener(e,o,n),r.call(this,s)},n):t.attachEvent&&t.attachEvent("on"+e,function o(s){i&&t.detachEvent(e,o,n),r.call(this,s)})}function y(t){for(var e in t)0===e.indexOf("_")&&delete t[e];for(var r,n=1;n<=15;n++)E(t,r="bl"+n)&&(t["w_"+r]=t[r],delete t[r]);r=null,function(t,e,r){for(var n,i=e.length,o=0;o<i;o++)"string"==typeof(n=t[e[o]])?t[e[o]]=n.substring(0,r):"object"==typeof n&&(n=JSON.stringify(n),t[e[o]]=n.substring(0,r))}(t,["c1","c2","c3","c4","c5","c6","c7","c8","c9","c10"],128)}var w="undefined"!=typeof navigator?(navigator.userAgent||"").toLowerCase():"";function m(){return w.indexOf("quark/")>-1}function b(){return w.indexOf("quarkpc/")>-1}function R(t,e,r,n){var o;if("function"==typeof(null==(o=window)||null==(o=o.ucapi)?void 0:o.invoke)){var s=i({},e,{success:r,fail:n});window.ucapi.invoke(t,s)}else n&&n("ucapi is not exist")}var E=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},k=function(t){if(!t)return 0;try{return"function"==typeof TextEncoder?(new TextEncoder).encode(t).length:function(t){for(var e=0,r=0,n=t.length;r<n;r++){var i=t.charCodeAt(r);e+=i<128?1:i<2048?2:i<55296?3:i<56320?4:3}return e}(t)}catch(e){return t.length}},S=function(){function t(t){this.logSrc="jssdk",this.sdkCode="default",t=t||{},this.bid=t.bid||"",this.cid=t.cid||"",this.uid=t.uid||"",this.rel=t.rel||"",this.utdid=t.utdid||void 0,this.debug=t.debug||!1,this.delay=!1!==t.delay,this.cluster=t.cluster||r.ZH,this.sampleRate=t.sampleRate,this.ready=!1,this.plugins=t.plugins||[],this.gateway=t.gateway||""}var e=t.prototype;return e.print=function(){this.debug&&o.apply(void 0,arguments)},e.isReady=function(){return this.ready},e.setReady=function(){this.ready=!0},e.setConfig=function(t){var e=this;if(c(t)){var r=function(r){var n;(function(t,e){for(var r,n=0,i=t.length;n<i;n++)if(r=t[n],e.call(this,r))return!0;return!1})(["plugins"],function(t){return t===r})||g(e,((n={})[r]=t[r],n))};for(var n in t)r(n)}},t}(),P=function(){function t(){this.logList=[],this.preLogList=[]}var e=t.prototype;return e.getLogList=function(){return this.logList},e.takeLogList=function(){var t=this.logList;return this.logList=[],t},e.getPreLogList=function(){return this.preLogList},e._updateLogQueue=function(t){var e=this.logList.length,r=!0;if(1!==t.category||0===e)this.logList.push(t);else{for(var n,i=0;i<e;i++)if((n=this.logList[i])._hash===t._hash){n.w_cnt=n.w_cnt?++n.w_cnt:1,r=!1;break}r&&this.logList.push(t)}return r},e.popLog=function(){return this.logList.shift()},e.popPreLog=function(){return this.preLogList.shift()},e.pushLog=function(t){return this._updateLogQueue(t)},e.hasLog=function(){return this.logList&&this.logList.length>0},e.pushPreLog=function(t){this.preLogList.push(t)},e.hasPreLog=function(){return this.preLogList&&this.preLogList.length>0},e.setPreLogList=function(t){void 0===t&&(t=[]),this.preLogList=this.preLogList.concat(t)},e.clearLogList=function(){this.logList=[]},t}(),L=function(t){return t.ZH="cn",t.QUARK="quark",t.INTL="intl",t}({}),x=function(){function t(){}return t.getAddr=function(e,r){return r?""+r+t.uploadPath:""+t.hosts[e.valueOf()]+t.uploadPath},t.getConfAddr=function(e,r){return r?""+r+t.jconfigPath:""+t.hosts[e.valueOf()]+t.jconfigPath},t.getHosts=function(e){return t.hosts[e]},t}();x.hosts={cn:"https://px.effirst.com",intl:"https://px-intl.ucweb.com",quark:"https://px.wpk.quark.cn",er:"https://erpx.effirst.com"},x.uploadPath="/api/v1/jssdk/upload",x.jconfigPath="/api/v1/jconfig";var O=function(t){return t[t.JSERR=1]="JSERR",t[t.API=2]="API",t[t.PERF=3]="PERF",t[t.RESERR=4]="RESERR",t[t.PVUV=5]="PVUV",t[t.BKPG=6]="BKPG",t[t.LONGTASK=8]="LONGTASK",t[t.INPD=15]="INPD",t[t.NODERES=16]="NODERES",t[t.PGERROR=17]="PGERROR",t[t.BLOCK=18]="BLOCK",t[t.PERFNEXT=1e3]="PERFNEXT",t[t.MAINDOC=1e5]="MAINDOC",t[t.RESTIMING=100001]="RESTIMING",t}({});function I(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return C(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}!function(t){t.JSERR="jserr",t.API="api",t.PERF="jsfsperf",t.RESERR="resloadfail",t.PVUV="flow",t.BKPG="bkpg",t.CUSTOM="jssdkidx",t.INPD="inputdelay",t.LONGTASK="longtask",t.NODERES="nodres",t.PGERROR="pgerror",t.BLOCK="h5block"}({});var N,A=window,j=document,T=navigator,B=location,U=void 0!==A.devicePixelRatio?A.devicePixelRatio:1,D="__itrace",M="__itrace_conf",q="__itrace_wid",G="__wpkreporterwid_";function V(t,e){for(var r,n,i=t.split("."),o=e.split("."),s=i.length,a=0;a<s;a++)if((r=parseInt(i[a]))!==(n=parseInt(o[a])))return r>n;return!0}function K(){var t=[],e=function(){for(var t=navigator.userAgent.split(" "),e=0;e<t.length;e++)if(t[e].toLowerCase().indexOf("quarkpc/")>-1)return t[e].split("/")[1]}();return e&&(V(e,"1.0.0.0")&&t.push.apply(t,["flow","blank"]),V(e,"2.0.0.0")&&t.push.apply(t,["perf","jserror"])),t}function J(t){try{if(s(window)&&window.hasOwnProperty("ucweb")&&window.ucweb.window||s(t)){for(var e=(t||T.userAgent).split(" "),r=e.length,n=!1,i=0;i<r;i++)if(-1!==e[i].indexOf("UWS/")){n=V(e[i].split("/")[1],"2.13.2.37");break}return n||w.indexOf("ucbrowser/")>-1||m()}}catch(t){console.error(t)}return!1}var F=function(){var t,e;return 3===(null==(t=window.ucweb)||null==(t=t.window)||null==(t=t.performance)?void 0:t.pt)||(null==(e=window.compass)||null==(e=e.env)?void 0:e.isPrerender)};function H(t){try{var e="__wpktestingls__";return t().setItem(e,e),t().removeItem(e),!0}catch(t){return!1}}function Q(){return localStorage}var W={get:function(t){if(H(Q)){var e=Q().getItem(t);if(e){if(e=JSON.parse(e),Date.now()<e.expireAt)return e;this.rm(t)}}return null},set:function(t,e){H(Q)&&t&&e&&(e.expireAt=Date.now()+18e5,Q().setItem(t,JSON.stringify(e)))},rm:function(t){H(Q)&&Q().removeItem(t)}};function X(){return sessionStorage}var z=function(t,e){if(!e)return!0;if(!u(e))return!1;if(1===e.length)return t===e[0];if(2===e.length){var r=e[0],n=e[1];return r&&!n?i(t,r):r&&n?i(t,r)&&i(n,t):i(n,t)}return!1;function i(t,e){var r=t.split("."),n=e.split(".");return!(parseInt(r[0])<parseInt(n[0]))&&(parseInt(r[0])>parseInt(n[0])||!(parseInt(r[1])<parseInt(n[1]))&&(parseInt(r[1])>parseInt(n[1])||parseInt(r[2])>=parseInt(n[2])))}};function Z(t,e,r,n){var i="itracereporter:dynamicConf:"+t,o=W.get(i);if(o)d(n)&&n(o);else{var s=f({app:t,tm:l(!0),ud:a(),sver:e,sign:"c41e43c828c16c16a6eb1c9c1e68e8ce"});!function(t,e){if("undefined"==typeof XMLHttpRequest)e();else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){var t;if(200===r.status&&r.response)try{var n=JSON.parse(r.response);0===n.code&&(t=n.config||[])}catch(t){}e(t)}};try{r.open("GET",t,!0),r.timeout=3e3,r.send()}catch(t){}}}(r+"?wpk-header="+encodeURIComponent(s),function(t){if(o={},void 0!==t){for(var r=t.length,s=0;s<r;s++){var a=t[s],c=a.sdkver;if(z(e,c)){if(a.common&&void 0!==a.common.sampleRate&&(o.all=a.common.sampleRate),a.config)for(var u=a.config.length,p=0;p<u;p++){var l=a.config[p];if(l.type){if(l.category_rate)for(var f in l.category_rate)o[l.type+"@"+f]=l.category_rate[f];l.sampleRate&&(o[l.type]=l.sampleRate)}}break}}try{W.set(i,o)}catch(t){}}d(n)&&n(o)})}}function $(){return A.cookieStore}var Y=function(t,e){var r;null==(r=$())||r.get(t).then(function(t){e(null==t?void 0:t.value)}).catch(function(t){console.error(t),e(null)})},tt=function(t){var e;Object.assign(t,{sameSite:"none"}),null==(e=$())||e.set(t).catch(function(t){return console.error(t)})},et=function(t){var e;null==(e=$())||e.delete(t).catch(function(t){return console.error(t)})},rt={},nt=function(t,e,r,n,i){if(void 0===e){if(!rt[t]){var o=null,s=new RegExp(t+"=([^;]+)");try{o=s.exec(j.cookie)}catch(t){return null}o&&(rt[t]=o[1])}return rt[t]}var a=t+"="+e;n&&(a+="; domain="+n),i&&(a+="; path="+i),r&&(a+="; max-age="+r);try{j.cookie=a}catch(t){return null}return a},it=null;function ot(t,e){var r,n;(n=$())&&"function"==typeof n.get?(console.warn("[itrace says] using cookieStore"),t?(et(q),et(G),(r=it)||(r=a(),it=r),e&&e(r)):Y(q,function(t){t||(t=a(),it=t),tt({name:q,value:t,expires:Date.now()+15552e6}),e&&e(t)})):(console.warn("[itrace says] using document.cookie"),t?(!function(){var t=nt(q);t&&nt(q,"",-1),(t=nt(G))&&nt(G,"",-1)}(),r=it):r=nt(q),r||(r=a(),t?it=r:nt(q,r,15552e3)),e&&e(r))}var st=function(t){return"itrace"+(t.replace(/^\S/g,function(t){return t.toUpperCase()})+"Plugin")},at=function(t,e){try{var r=st(e.id),n=window[r];if(d(n))new n(e).init(t),t.print(e.id+" plugin init success");else t.print(e.id+" plugin's constructor is not exist")}catch(r){t.print(e.id+" plugin init fail: ",r)}},ct=function(t,e){try{new(0,e.plugin)(e).init(t),t.print(e.id+" plugin init success by option.plugin")}catch(r){t.print(e.id+" plugin init fail: ",r)}};function ut(t,e){var r=t._sdkEnv.useU4Monitor,n=["flow","interface","jserror","perf","resource","blank"],i=[],o=[];t._sdkEnv.isQuarkPC&&(n=K());for(var s,a=I(e);!(s=a()).done;){var c=s.value,u="string"==typeof c?{id:c,plugin:null}:c;if(u.id){if(r&&n.includes(u.id)&&!u.forceEnable){if(t.print("uccore monitor has been enabled, so ["+u.id+"] plugin will be ignore. you can set the plugin option [ forceEnable ] as true to enable it."),"interface"!==u.id||!u.enableTrace)continue;u.onlyForTrace=!0}if(u.plugin&&d(u.plugin))ct(t,u);else{var p=st(u.id);d(window[p])?(t.print(u.id+" plugin already exists in window, init it immediately"),at(t,u)):(i.push(u),o.push("itrace-"+u.id+".iife.js"))}}else t.print("plugin options has no id, base sdk will ignore it")}!function(t,e,r){if(r.length<=0)t.print("no plugins need load from cdn");else{var n=(t.cdn||"https://g.alicdn.com/woodpeckerx/itrace-next")+"/??",i=document.getElementsByTagName("script")[0],o=document.createElement("script");if(o.type="text/javascript",o.crossOrigin="anonymous",o.async=!0,i&&i.parentNode)i.parentNode.insertBefore(o,i);else{var s=document.head;null==s||s.appendChild(o)}o.src=n+r.join(","),o.onload=function(){for(var r,n=I(e);!(r=n()).done;){var i=r.value;at(t,i)}}}}(t,i,o)}function dt(){var t;if(!j)return{};var e=j.referrer;e&&-1!==e.indexOf('"')&&(e=encodeURIComponent(j.referrer));var r,n=function(){if(void 0===N){var t=(T?T.userAgent:"").toLowerCase();N=t.indexOf("electron/")>-1}return N}()?"renderer":void 0,i=null==(t=A.__itracecfg__)?void 0:t.wv_traceid,o=T.deviceMemory||-1;return{w_url:(B.origin?B.origin:B.protocol+"//"+B.host)+B.pathname,w_query:B.search,w_ref:B.hash.substring(1),w_title:j.title,ua:T.userAgent,referrer:e,dsp_dpi:U||1,dsp_w:A.screen.width,dsp_h:A.screen.height,w_wv_traceid:i,wk_proc_type:n,wl_devmem:o,net:(r=T.connection,r&&r.type?"none"===r.type?"disconnected":"cellular"===r.type?"slow-2g"===r.effectiveType?"2g":r.effectiveType:r.type:"")}}var pt=function(t,e,r){if("function"==typeof XMLHttpRequest){var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","text/plain"),n.timeout=5e3,n.send(r)}else t.print("xhr is not supported")},lt=function(t,e){R("webMonitor.reportWpkLog",e,function(e){t.print("report success by jsapi",e)},function(e){t.print("report failed by jsapi",e)})};function ft(){return T&&!!T.sendBeacon&&A.Blob}var ht=function(t){try{return 1===((null==A?void 0:A.nativeWpkReport)||{})[t]}catch(t){return!1}};function gt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return vt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}!function(){if(!c(window)||!s(window.navigator))throw new Error("iTrace sdk only support")}();var _t=function(t){function r(e){var r;return(r=t.call(this,e)||this).uc_param_str="",r.cdn="",r._sdkEnv={},r._wid="",r._begin=0,r._sid="",r._frmId="",r._dyStart=0,r._hasWidTimer=!1,r.spa=e.spa||!1,r.ignoreU4HA=!0===e.ignoreU4HA,r.checkHidden=!1!==e.checkHidden,r.disableCookie=!0===e.disableCookie,r.supportBeaconBody=!1!==e.supportBeaconBody,r.maxSessDuration=e.maxSessDuration||288e5,r.immediatePV=!1!==e.immediatePV,r.uc_param_str=e.uc_param_str||"prveosfrnwutmisvbditcu",r.sdkVer="2.3.32",r.sdkCode="browser",r.beforeSend=e.beforeSend,r.clearBeforeunload=!1!==e.clearBeforeunload,r.cdn=e.cdn||"",r._logq=new P,r._dying=!1,r._prerender=e.prerender,r.useNativeCH=!1!==e.useNativeCH,!e.cluster&&m()&&(r.cluster=L.QUARK),r}!function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,e(t,r)}(r,t);var n=r.prototype;return n.prerenderCommit=function(){if(this._sdkEnv.hasPrerenderCommit)this.print("prerenderCommit can only call once");else{this.print("prerender commit event"),this._sdkEnv.hasPrerenderCommit=!0;var t=new Event("wpkpageforeground");window.dispatchEvent(t),this.reportImmediatePV(!0)}},n._listenCompassPrerenderEvt=function(){var t=this;F()&&(this._sdkEnv.prerenderType="compass",_(document,"prerendercommit",function(){t.prerenderCommit()},!1,!0),_(document,"touchstart",function(){t.prerenderCommit()},!1,!0))},n._loadPlugins=function(){if(u(this.plugins)&&this.plugins.length>0)try{ut(this,this.plugins)}catch(t){this._reportToSelf(t,{c1:"插件初始化异常"})}},n._normalizeLog=function(t){var e=t.uid||this.uid||this._wid,r=t.rel||this.rel,n=dt(),i=p(t.category),o=g({uid:e,utdid:t.utdid||this.utdid,wid:this._wid,type:i,category:t.category,w_cnt:1,w_rel:r,w_bid:t.bid||this.bid,w_cid:t.cid||this.cid||void 0,w_spa:this.spa,w_frmid:this._frmId,w_tm:l(),log_src:this.logSrc,sdk_ver:this.sdkVer,uc_param:this.uc_param},n,t),s=this._genReportUrl(o,!0);return o._url=s,o._hash=function(t){var e="";switch(t.category){case 1:e=[t.category,t.uid,t.w_url,t.w_ref,t.w_msg||"",t.w_line||"",t.w_col||""].join("");break;case 2:e=[t.category,t.uid,t.w_res,t.w_method,t.w_rc].join("");break;case 4:e=[t.category,t.uid,t.w_url,t.w_ref,t.w_res,t.w_type].join("")}return e}(o),o},n._genReportUrl=function(t,e){var r={app:t.w_bid||this.bid,cp:"none",de:e?4:1,seq:""+Math.floor(+new Date/1e3)+Math.floor(1e4*Math.random()),tm:l(!0),ud:encodeURIComponent(t.uid||this.uid||this._wid),ver:t.rel||this.rel,type:t.type||p(t.category),sver:this.sdkVer,sign:"9bf8a190ef82c5049df7b199c599c45b"};return x.getAddr(this.cluster,this.gateway)+"?wpk-header="+encodeURIComponent(f(r))+(this.uc_param_str?"&uc_param_str="+this.uc_param_str:"")},n.send=function(t,e,r){if(r)pt(this,t,e);else if(s(e)){navigator.sendBeacon(t,e)||(this.print("beacon send fail, retry by xhr"),pt(this,t,e))}else this._sdkEnv.supportBeacon?navigator.sendBeacon(t):(n=t,i="itraceimgreporter_"+l()+".r"+Math.floor(1e3*Math.random()),(o=A[i]=new Image).onload=o.onerror=function(){A[i]=null},o.src=n);var n,i,o;this.print("log is sent: ",t)},n.setReady=function(){var e=this;t.prototype.setReady.call(this),v(function(){e._sendQueuingLogs()},0)},n._updateSpecialFields=function(t){return t._dirty?g(t,{w_bid:this.bid,w_cid:this.cid,w_rel:this.rel,uid:this.uid,utdid:this.utdid}):t},n._enhanceLog=function(t){this.print("enhance log",this._wid),t.wid=this._wid,void 0!==t.uid&&null!==t.uid&&""!==t.uid||(t.uid=this._wid,t.regenurl=!0),y(t)},n._isWidReady=function(){return!(!this._wid||""===this._wid)},n._sendQueuingLogs=function(){var t=this;if(this._logq.hasLog()){if(!this._isWidReady())return this._hasWidTimer||(this._hasWidTimer=!0,ot(this.disableCookie,function(e){t._wid=e}),v(function(){t._sendQueuingLogs()},500)),void this.print("wid is not ready, will retry after 500ms.");var e=this._logq.takeLogList(),r=e.length;if(this._sdkEnv.sendByJsapi)for(var n=0;n<r;n++)try{var i=e[n];i.w_send_mode="jsapi",i._url=void 0,this._updateSpecialFields(i),this._enhanceLog(i),lt(this,{type:i.type,immediate:"jsfsperf"===i.type?0:1,args:i})}catch(t){this.print(t)}else if(this._sdkEnv.supportBeaconBody&&this.supportBeaconBody)for(var o,s=function(t){for(var e=[],r=[],n=t.length,i=0;i<n;i++){var o=t[i].category;-1===r.indexOf(o)&&r.push(o)}for(var s=r.length,a=0;a<s;a++){for(var c=r[a],u=[],d=0;d<n;d++){var p=t[d];p.category===c&&u.push(p)}e[a]=u}return e}(e),a=gt(s);!(o=a()).done;){var c=o.value;try{for(var u,d=[],p=0,l=gt(c);!(u=l()).done;){var f=u.value;this._updateSpecialFields(f),this._enhanceLog(f),f.w_send_mode="beacon";var h=JSON.stringify(f),g=k(h);g>6e4?(this.send(this._genReportUrl(f,!1),h,!0),this.print("single log oversize 60k, send by xhr")):((p+=g)>6e4&&(this.send(this._genReportUrl(f,!1),d.join("\n")),this.print("group log length is "+d.length+" size is "+p+" oversize 60k, send now"),d.splice(0,d.length),p=g),d.push(h))}if(d.length>0){var _=this._genReportUrl(c[0],!1);this.send(_,d.join("\n"))}}catch(t){this.print(t)}}else for(var y=0;y<r;y++){var w=e[y],m=w._url||"",b=w._forcePost||!1;this._updateSpecialFields(w),this._enhanceLog(w),w.w_send_mode=b?"fetch":ft()?"beacon":"img";try{var R=JSON.stringify(w);(b=b||k(R)>7500)?(m=this._genReportUrl(w,!1),this.send(m,R,b)):(w.regenurl&&(this.print("regen report url"),m=this._genReportUrl(w,!1)),m+="&data="+encodeURIComponent(R),this.send(m))}catch(t){this.print(t)}}}else this.print("logq is empty.")},n._handlePreReporting=function(){var t=window.__iTraceLogQueue;if(u(t)&&t.length>0&&(this._logq.setPreLogList(t),window.__iTraceLogQueue=[],this.print("preLogList is updated")),this._logq.hasPreLog()){this.print("handling logq for pre-reporting");for(var e=this._logq.getPreLogList();e.length;){var r=e.shift(),n=null==r?void 0:r.shift();d(this[n])&&(this[n].apply(this,r),this.print(n+" is called by pre-reporting."))}}},n.resetSession=function(){var t;this._sid=(t=a(),H(X)&&X().setItem("wpkreporter:frmid",t),t),this._begin=Date.now(),this._frmId=this._sid},n._useU4Monitor=function(){return!this.ignoreU4HA&&(J()||b())&&function(t){if(s(document)&&document.getElementsByTagName)for(var e=document.getElementsByTagName("meta"),r=e.length,n=0;n<r;n++){var i=e[n];if(i.name===t)return i.content}return""}("wpk-bid")===this.bid},n.init=function(){this._syncDyConf(),this.resetSession(),this.initSdkEnv(),this._loadPlugins(),this._listenCompassPrerenderEvt();var t=this;v(function(){t.reportImmediatePV(),function(t,e){try{R("biz.ucparams",{params:t},function(t){e.uc_param=t,e.print("get uc_param success",t)},function(t){e.print("get uc_param_str error: ",t)})}catch(t){e.print("get uc_param_str error: ",t)}}(t.uc_param_str,t)},0);var e=this._sdkEnv.isIOS?"pagehide":"beforeunload";_(window,e,function(){(t.isReady()||t.clearBeforeunload)&&(t._sendQueuingLogs(),t.print("do clearing jobs on page unload~"))},!0),this._sdkEnv.isPrerender&&this.print("预渲染场景下，白屏、性能检测时机为webview上屏之后")},n.initSdkEnv=function(){try{this._sdkEnv.useU4Monitor=this._useU4Monitor(),this._sdkEnv.isPrerender=F()||this._prerender,this._sdkEnv.iOSNBCheck=this.useNativeCH&&ht("enableBlankReport"),this._sdkEnv.sendByJsapi=this.useNativeCH&&ht("enablePerformanceReport"),this._sdkEnv.isIOS=/(iphone|ipad|ipod|ios)/i.test(w),this._sdkEnv.supportBeacon=!!ft(),this._sdkEnv.supportBeaconBody=this._sdkEnv.supportBeacon&&!this._sdkEnv.isIOS,this._sdkEnv.isQuarkPC=b(),this.print("sdk env:",this._sdkEnv)}catch(t){this.print("init sdk env error",t)}},n.reportImmediatePV=function(t){void 0===t&&(t=!1),this._sdkEnv.useU4Monitor||this._sdkEnv.isPrerender&&!t||!this.immediatePV||this.reportFlow()},n.report=function(t){var e=this;if(this.print("reporting data:",t.category,t),!t||!t.category)return this;var r=t.sampleRate||this.sampleRate;if(r||0===r||(r=1),!h(r))return this.print("log is rejected by sampling rate, type: %s category: %s, rate: %s log: %o",t.type,t.category,r,t),this;Date.now()-this._begin>=this.maxSessDuration&&this.resetSession();try{var n=this._normalizeLog(t);if(this._dyConf&&Date.now()<this._dyConf.expireAt){var i=n.type+"@"+n.category,o=this._dyConf[i];if(s(o)||(i=n.type||"undefined",o=this._dyConf[i]),o=s(o)?o:this._dyConf.all,s(o)&&!h(o))return this.print("log is rejected by dynamic sampling rate, type: %s, category: %s, rate: %s log: %o",n.type,n.category,o,n),this}else!this._dying&&Date.now()-this._dyStart>=18e5&&(this.print("syncing dynamic config"),this._syncDyConf());if(this._handlePreReporting(),d(this.beforeSend))try{if(!1===this.beforeSend(n))return this.print("the beforeSend hook rejects this log"),this}catch(t){this.print("beforeSend hook error",t)}n.category===O.JSERR&&delete n.error;var a=this.isReady();if(n._dirty=!a,!this._logq.pushLog(n))return this.print("log merged: ",n),this;if(a)v(function(){e._sendQueuingLogs()},!n._reportNow&&this.delay&&-1!==[1,2,4,8,15,18].indexOf(n.category||0)?1e3:-1);else this.print("sdk is not ready, you should call setReady to trigger reporting.")}catch(e){this.print("report failed: ",t,e),this._reportToSelf(e)}return this},n.reportFlow=function(t){var e=t||{};return e.category=O.PVUV,this.report(e),this},n.reportJSError=function(t,e){return!function(t){var e={}.toString.call(t);return("[object Error]"===e||"[object Exception]"===e||"[object DOMException]"===e||e instanceof Error)&&c(t)}(t)?this.print("the input is not a real JSError"):((e=e||{}).category=O.JSERR,e.w_msg=t.toString(),e.stack=function(t){if(t.stack){var e=t.stack.split("\n");return e.shift(),e.join("\n")}return""}(t),e.w_file=t.filename||"",e.w_line=t.lineno,e.w_col=t.colno,this.report(e)),this},n.reportApi=function(t){if(t){c(t.queryString)&&(t.queryString=f(t.queryString));var e=g(t,{category:O.API,w_type:16,w_res:t.url,w_method:t.method,w_param:t.queryString,w_body:"object"==typeof t.body?JSON.stringify(t.body):t.body,w_resp:t.response,w_rc:t.status,w_rt:t.spent||0},{url:void 0,queryString:void 0,response:void 0,body:void 0,status:void 0,spent:void 0});this.report(e)}return this},n.reportBlankPage=function(t){var e=t||{};return E(t,"w_fp")||(e=g(t,{w_fp:999})),e=g(e,{category:O.BKPG}),this.report(e),this},n.reportPerf=function(t){return this._hasReportPerfData?(this.print("do not repeat report performance data"),this):(this.print("manual report performance data"),this.__customPerfCache__=t,this)},n.detectBlank=function(t){return this.print("need itrace-blank plugin"),this},n.detectBlock=function(t,e){return this.print("need itrace-fluency plugin"),this},n._syncDyConf=function(){var t=x.getConfAddr(this.cluster,this.gateway),e=this;e._dyStart=Date.now(),e._dying=!0,Z(e.bid,e.sdkVer,t,function(t){e._dying=!1,e._dyConf=t,e.print("jconfig come back")})},n._reportToSelf=function(t,e){void 0===e&&(e={});this.reportJSError(t,g({bid:"itrace-next"},e))},r}(S),yt=window;function wt(t){var e=t||yt[M]||{},r=new _t(e);return r.init(),r}return yt[M]&&c(yt[M])&&!s(yt[D])&&(yt[D]=new _t(yt[M]),yt[D].init()),yt.__getItraceInstance||(yt.__getItraceInstance=wt),t.getItraceInstance=wt,t.getItraceSingleton=function(t){if(yt[D])return yt[D];var e=t||yt[M]||{};return yt[D]=new _t(e),yt[D].init(),yt[D]},t.iTraceReporter=_t,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
